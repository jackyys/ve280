#include "card.h"
#include "hero.h"
#include "exceptions.h"
#include <iostream>
#include <random>

using namespace std;

const char *GENDER_NAMES[] = {"Male", "Female"};

Hero::Hero(Kingdom kingdom, Gender gender, unsigned int life, const string &name, const string &asciiArt) :
        kingdom(kingdom), gender(gender), life(life), name(name), asciiArt(asciiArt) {}


Kingdom Hero::getKingdom() const {
    return kingdom;
}

Gender Hero::getGender() const {
    return gender;
}

unsigned int Hero::getLife() const {
    return life;
}

string Hero::getName() const {
    return name;
}

void Hero::printName() const {
    cout << "\033[" << kingdom << "m" << name << "\033[0m";
}

void Hero::printHero() const {
    printName();
    cout << endl << "\033[" << kingdom << "m" << asciiArt << "\033[0m" << endl;
}

Hero::~Hero() {
    for (const Card *castedCard: castedCards) {
        delete castedCard;
    }
}

ZhaoYun::ZhaoYun() : Hero(SHU, MALE, 4, "赵云", R"(    ,/##(*%@@%/###(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((/*,......,*/(####/
  .,/(#&%/%@@%(%#/*//////////////////////////////////////////////////////////////////*********//(#(
*//##%%/&@@%(#//%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%(((
#%#((#%#/,***/(#//%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%(((
#&&&&%(,    .,*/*/%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%(((
#####/.  ,@@@@@@@@@@@&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%(((
%%%%%(,..,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%(((
/#######//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%(((
((/***//*(@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%/(/
(//%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%/(/
(//%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&%%%%%&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&@@@@@@@@@@@@@@@%/((
(//%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&%%&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%#((###%&@@@@@@@@@@@@%///
(//%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&@@@@@@@@@@@@@@@@@@@@@@&&&&&&&&%(#%&&%%#%&@@@@@@@@@@@%///
(//%&&@@@@@@@@@@@@@@@@&&&&&&&&&&&@@@@@@@@@@@@&&&&%%%%%&&@@@@@@@@@@@&&&%%##&&&&&&&&&&@@@@@@@@@@@%/(/
((/%&&@@@@@@@@@@@@@@&&%####%%&&&&&&@@@@@@@@@&&%%#((((((##%&@@@@@@@@@@@&%##&&&&%%%&&&@@@@@@@@@@@%/(/
(//%&@@@@@@@@@@@@@@&%##((((###%&&&@@@@@@@@@@&%%#(/****,***/(#&@@@@@@@@&%%%%%%%%###%&&&@@@@@@@@@%/(/
(//%@@@@@@@@@@@@@@@&%########%%&&@@@@@&&&@@@&&%%#///**,,,,*//(#&@@@@@&&%%%%%&%%######&@@@@@@@@@%/(/
(//%&@@@@@@@@@@@@@&###%%&&&&&@@@@&&%%&&&@@@@&&%#(/*,.,,,,*/((#&@@@@&&%%#%%%%%#((#((%@@@@@@@@@%/(/
(//#&&@@@@@&%%((#%&&%%&&&&@@@@@@@@&&&&&&&&&&@@@@@%(*,..,,,***//(#%&@@@&&&%%###%####(#&@@@@@@@@@%/(/
(//#%&&@@@@&&%(/(#%&&@@@&&&@@@@@@&&&@@@&%##(#%%&&(*,,,,,****//((%&@@@&&%%###%%##(/&@@@@@@@@@@%/(/
(//##%&@@@&&&&%##%&&@@@@@@@@@@@@&&@@&%&//((((((%&/,,,,***//////(%@@@&((((((/(%@@@@@@@@@@@%/(/
(//###&@@@&&%%%&&&&@@@@@@@@@@@&&&&&&&%%#(/**/((///(%%#*,,,**////////(&@@@&(////((%&@@@@@@@@@@@@%/(/
((/###%&@@&%%%#%&&@@@&&&&&&&&&&%%#%%%##//**,,,,**,*/#%(/*****////////#&@@////%&@@@@@@@@@@@@@@%/(/
(//#%##%@@&%#((%%%&&@@@&%%%%%&%%##(((((/*,,......,,,,*%#(***///////**/(%&&%(/(%@@@@@@@@@@@@@@@@%/(/
(//####%&@@((///(#&@@(######((/****,,,.........,,,(##(/*///////***/(%&&%#%&@@@@@@@&@@@@@@@@%/(/
(//#((##%&@@%(/****/#&&%(,*/(//**,,,,,................,*/((/***////*****/#&&&&&&@@@@@@&&&&&&&&/(/
(//(//(#%&@@/*******///,*////**,,,..................,,,*///***********/(&@@@&&&@@@@&&&&%&&&%%(*(/
(//(///(#%&@@%(****,,,,**,,*////**,,,..................,,,,///**********/(&@@@&&&&&&&&&%%#####%(*(/
(//#(////#&&@@&/****,,.,,.,*/////**,,,..................,,,,***********/(#&&&&&&&%%#(////(###%%#/((
(//#(/////#&&@@#/****,,,,.,**/////***,,..................,,,,********//(%%%%##((///***//(###%%%(/(/
(//%#((((((#%&@&%(/**,,,,.,,**///////**,,................,,,****((###((///////******((##((#####(/(/
(//%#(((///((%&@&%(/*,,,,.,,**//(((((((*,................,,*/((#((////////((((//(###(////(((##%(/(/
(//#%(///////(#&&@***,,,,*/##%%&&%%#(,.................,,,*/(#(/***,**/((##((((*******//(#%%%(/((
(//#%#(///////(#%&@&/**,*/(##%%%%%##((/,..........,,....,,,,***(#(*******/(////((*******/((#%%%(/(/
(//###(/////////(#&/***//((((((((((/*.....,*////*,,,,,,,,,****##(/*,***/(//((/*******/((#%%%/(/
(//##((((//////////(&%(***,,..    ,,*,,*/(###(*,,,*,,,,,,,,,****/(%%#**,,,/((((/****//(#%%%&&&/(/
(//##(((((//(((/////(%%(/**,,..    .,,*(###/,,,**/**,,,,,,,*****(#%&&(/*,,*/#%#/****(##%%&&&&&/(/
///%#((((#((////////**/(#****,..     ..,,,,*/((((/*,,,,,,,,***/(%%%%%&/*,,/##///((%##%%%%##%%(*(/
///%#((((#(////(((//*,,*//***,,.       .,,,.,*****,,,,,,,,,**(#%%%%%%&&&%(,,*/##((#%#(##%##%%%#/*(/
///%#((((((((((((((/*,,,*/***,,.. ..  . .,,,,,,,,,,,,,,,,,,(#%%%%%%%%%%&&%**,*/####%####%%#%%%#(/(/
///##((((##((((((((/**,,*******,,......   ..*,,,,.....,,/(#%%&&&%%%%%%##%&(/***#%###&&&&&&%%%%((/(/
///##((((#((((((((((*************,..........***,,...,,(#%%%&&&&&%%%%%####%%(***(#%##&&&&&/*/((//##/
,,/#((((((((((((((((//***********,.....,,*/#%%%#(#%%&&&&@@@@@@@@&&%%%##(((&%#/*/(#%%&&&&&(%(****,
.,/#(((((((((((((((((//***********,,,,*(#%&&&&&&&&&@@@@@@@@@@@@@&&&%%##(((%&%(/*/#%%&&@&&(%#*(##(((
.,/#(((((((((((////(((//**********//(#%&&&&&&&&&&@@@@@@@&&&@@@@@@&&&%##(((#%&%(///((%%%%%#%#/((/***
 .*#(((###(((((/////((//*///((#%%&&&&&&@@@@@@@@@@@@@@@@@@@@@@@@@&&&&%##((((#%%%(/,*%&%%%&&%/,.  .//
..*##(####(((((/////(##(((#%%&&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&%%#(((//(#%%%(*(%//////*. ,*,*(/
*,*##(((##(((///////(#%&&&&&&&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&%%#((//((#%&&%//(/%@.. .(%((#(
##(/////////////******/////////////////////////////////////////////*********///(((#(/%@&(,***/((##()") {}

const Card *ZhaoYun::castCard(const Card *card) {
    if (card == nullptr) {
        throw NonCastableCardException(card);
    }
    const Card *castedCard;
    switch (card->getAction()) {
        case STRIKE:
            castedCard = new Dodge(card->getSpot(), card->getSuit());
            break;
        case DODGE:
            castedCard = new Strike(card->getSpot(), card->getSuit());
            break;
        default:
            throw NonCastableCardException(card);
    }
    castedCards.push_back(castedCard);
    return castedCard;
}

ZhenJi::ZhenJi() : Hero(WEI, FEMALE, 3, "甄姬", R"(    ,/##(*%@@%/####(((((((((((((((((((((((((((((((((((((((((((((((//(((((((((((((/*,......,*/(####/
  .,/(#&%/%@@%(%#///////////////////////////////////////////////////**************************//(#(
*//#@%#%%/%@@%(#//%@@@@@@@@@@@@@@@&&@@@@@@@@@@@&%#%%&&&&%(//#&@&%#(**,,,,,,,,,,,,,,,,,*#&&@@@&%#(((
#%#(##%#/,,**/(#//%@@@@@@@@@@@@@@@&&@@@@@@@@@&&%%%%#%/,.,#&@&%(*........     .,,....,(%&@@&%##(((
#&&&&%(,.   .,*/*/%@@@@@@@@@@&&&@@@@@@@@@@@@@&&&%##%%(....*&&%#(,..,,,..  .......,,,,,*(%&@@&%#((((
#####/.  ,@@@@@@@@@@@@@@@@@@@&%%&@@&&&@@@@@@@&%###/,.. ./%@%(((///*,,.,,,,..,**//((((##%&@@@&%((/((
%%%%%(,..,@@@@@@@@@@@@@@@@@@@&&&&@@&%%&@@@@@&&%%#,    ,(&&%(###(*,,,*/////(#%%%%%%%&&&&&&&&&&%///((
/#######//@@&@@@@@@@@@@@@@@@@@@&&&@&&&&@@@@&@/,   ./&&%%%%(*,,*/(####%%&&@@@@&&&&&&&%%&&&&**/((
((/***///(@@&@@@@@@@@@@@@@@@@@&&%&@@&%%&@@@@@%(*, .*#&%%%%#*,,,*###(/%&@@@@@@@%%%&%%%%&&@&%(,,*(/
(//%@@@@@@@@&&@@@@@@@@@@@@@@@@@&%%&@&%#%&@@@@%(*,*(%#(///*,.,,/((//(%&&&&@@@@&&&&&&&%%##%@@&%/,,*((
(//%@@@@@@@@@&@@@@@@@@@@@@@@&&@&%%&@&&%#%%&&///*,,.,,.....,**,*(%%#/(#&&%%%%&@&&&%#/*/#@&%(,..,(/
(//%@@@@@@@@@&@@@@@@@@@@@@@@&&&@&&&&@@&&&&&&/*,  .,,.    ..,,,(((**,,/#%&&&&&%#(//,,.*#@*...,//
(//%@@@@@@@@@@@@@@@@@@@@@@@@&&&&&&%%&&&%##%%&%/,. .,,.     ....,*,..,*//((/////*,,,.  .*%@%/,...,//
(//%@@@@@@@@@@@@@@@@@@@@@@@@&&&&&&&&&&@&%######*....                                  ./%%/,....,(/
((/%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&%%###(*.                                    ,(&(,.....,(/
(//%@@@@@@@@@@@@@@@@@@@@@@@@@%#%&@&@@&&&&&&%%%#(/..                                  .*##.......,(/
(//%@@@@@@@@@@@@@@@@@@@@@@@@@%((#&&&%%%&&&(##(*,.                                  ./(*.......,(/
(//%@@@@@@@@@@@@@@@@@@@@@@@@&%%##%&&&&&%%%%#((/*,,,.                                .,/*. ....,,*(/
(//%@@@@@@@@@@@@@@@@@@@@@@@@&&%%&&&&%(/,,,/#%/,.,,,,.                               .,.   ....,**(/
((/#%&@@@@@@@@@@@@@@@@@@@@@@&%%#(((##/,....,%#*.,,**,.                              ,.   .....***(/
(//%%%&&@@@@@@@@@@@@@@@@@@@@&%%#*..*(#/     ,((*.,***,                                   ...,,(/*(/
(//#((%%&@@@@@@@@@@@@@@@@@@@@%%#(* .*((.     *(/*,*//,                                   ..,,*%#/(/
(//#*.,/#%@@@@@@@@@@@@@@@@@@@&&%#/. .*(,     .*//**//*                                  ..,,*(/(/
(//#(,    *#&@@&@@@@@@@@@@@@@@&&&%*...,(*.    .,*/**//.                                ..,*/#%%(*(/
(/*(#/.     ,(%@&&&@@@@@@@@@@@@@@&/*...**,.   ..,*////,      ..                       ...*((((#/*(/
(/*(**/,       /%&@@@@@@@@@@@@@@@@%(/,,.....     .,**///***///*,                     ..,***/(##(*(/
(/*(..*/,       .*(%@@@@@@&&&@@@@@&/*,....      ...,*//(/*,,,.                    ..,,**(#((%(/(/
(/*(.  ,/*         .#&@@@@@&&&@@@@&&/*,...         .........       ...,,**,,.     ..,,,((//#%#/(/
(/*(.    .*.         .*#&@@&%%&&@@@@&&&(/*,...               ...,**//(####/*.     ..,,,*//(##%%#/(/
(/*(.     .,,          .*&@@#%&&@&&&&&%#/*...           .,*/((#####((///,.      ..,****(#%%%%#/(/
(//(.                    *#&@##%@@&%#%&&&%*,.          .,(((/***,,,,*///.     ..,,,,*(#%%%%%%(*(/
(/*(,                     ,(&@&%(#@@@*/#%&%(/,...        .,,,,****/(/*,.     .,,,,*/#%%%%%%%#/*(/
((/(,                    ...*&@@#&@&%.  .,%&&%#*,...         .,,,,,.       ..,,**/%%&%####(/***(/
(/*(,.           ..........  /%&@%@@%. ...*(#%&%#(/*..                    ..,**/#%&&%%##(*,. .,(/
((*(,.               ..,,,,,,,/#&@%%&@&.  .,//(((#%%%#/*,..               ..,,*/#%%%%%%%#(/,....,(/
(/*(.               .....,,,...,/#&&&@@/,,*,,,**//(((#%%%#(*,...      .....,*(#&&%%%%%%%%&%(*...,(/
(/*(.               .....,,,,.  .*%%%&@(*,*////((((///(((((%##(/*,,.....,,(#%%%######(((#(*,    ,(/
///(.           .............     (#((%*,,,,,*/(/*,*///**#%%%%%%%##%%%%%%%###%&&&/*,.       ,(/
///(,.          ....,,,,,,,,.     ,/#(#%#/*.....,****////**##((#%%%#(//(%%#(##%%&%#/*//*. .    .,(/
///(................,,,,,,,,,...   ,/(#(/***...,,**,*//////(##%%##%##((/((#(**(%%#(#&/.      .*(/
///(,....,,,,,,,,,,,,,,,,........    ,//.  ..    ,////(((#%%%###(##(##(##%###(*.,,***,.        .*(/
///(*,,,,,,,,,,,,,,,,,,,,..          .**.      ../////(##((##(((((##(((((#####%/,.       .,,***/##/
,,/#*,,**,,,,,,,,,,,,......          ./,     ./(//((((#%#(#%(/#%(//(#%######%%%&&%#/.    /%(****,
.,*(/*,,,***,,,,,,,,,,.              ,/.      .*(((######(##(#%#(((##(####%#%%%###(*     /%#*/((//(
.,*(**********,,,........            .*      ..*#&%(//(/(###(((((######((###%%%%#(/*....,(%#//*,,,*
 .*(*,,,,*,,,,,.                    .**     *//*/#%%###(((####%##%%%%##%%%%%####/,*%&%%%%&%/,.  .//
..*(*,..,,...                       .*******,*/((///(#%%%%###((######%%%%%%#(//*,,(%**/*//*. ,,,*(/
*,*(*,,........   .,    ..,,.   .,#####((#%##%#//((##%#######%%%%%%%%&%%#%&%#(****/(*(/,,.. .//*/#(
##//**,,,,****,,,,,*,,,,,,**,,,,,*///**/****/////*****////////////*******//****/((#(*/*..,****//##()") {}

const Card *ZhenJi::castCard(const Card *card) {
    if (card == nullptr || card->getSuit() != SPADES || card->getSuit() != CLUBS) {
        throw NonCastableCardException(card);
    }
    const Card *castedCard = new Dodge(card->getSpot(), card->getSuit());
    castedCards.push_back(castedCard);
    return castedCard;
}

HuaTuo::HuaTuo() : Hero(NEUTRAL, MALE, 3, "华佗", R"(    ,/##(*%@@%/###((((((((((((((((((((((((((((((((((((((((((((((((//(((((((((((((/*,......,*/(####/
  .,/(#&%/%@@%(%#/*///*****////////*************************************/*////////**/*********//(#(
*//#@%#%%/%@@%(#/*%((////(#####(////*****,,,,,,,,,,,,,,,,,,,,,*****/////(((#####(/(%&&@@@@@@&%(((
#%#(##%#/,,**/(#//#%//*****/(###(/**,,,,,,,,,...................,,,,,,****//((((((/*,*#%&&@@@@&%(((
#&&&&%(,.   .,*/**##(//**,*/(%%%(/*,,,,,,,,,,,,,......,,,,,,,,,,,,,,,,***///((#(((//,,*(%&&&@@@%(((
#####/.  ,&%##%%%%%#**,,.*/((#%%(/**************,****,*******************////(###((/*,,,,#&&&@@%(((
%%%%%(,..,%#%&&%#(/*,,...*/((%%%#/***********************************////////(###((//*,.,*/%&@@%(((
/#######/*@&%#(//***...../(((%%%#(****//////****************////////////(((///(%%#((//*..**,/#@%(((
((/***//*(%%##(/*,,.....,(((#%%%#(****/////////////***///////////((((//(((***/(%%#((((/,.*/**/%#/(/
(//%@@@@@&%%#(/*,.....,,*((##%&%#/*,***/((((((/////////////////((((((((/**,***/%%%#(((/,,*/***(/*((
(//%@&&%%%((/*,......,*//(#%%&%#(*,,****//((#####(((((((((((((((((((#/*,,,,,**/#%%%####/,/(/**(/*(/
(//%&%%%#(/**,......,*/((##%%%#(/*,******//(########(((((((########(/*,,,,,,**/#%%%%###(**(////**//
(//%(///*,........,*/(#%%%%#(/*,,,*******/(####################(/**,,,,.,,***/#%%%####(*////(/*//
(//#((((/*........,,*/#%%%%%#//*,,,,,,,,***///(((##########(((((***,,....,****//(#%&%###(**/((/**(/
((/%%%(*,,,..,,....,/#&&&%%%%/*,,,,..,,,,***///**(((///((((((//***,,,,,,,,***//(#%&&&%##(*/(##/**((
(//#/****,,,,,....,*#&&%%%&%%(///******///((((((((##(/**/(####((////(/(((((((##&&&&&&&/(/***,,,(/
(//(////*,(%%/,...,*%&&&&&&&%#((#####%%&&&&&@@@&&&&%#(///(#&&&&&&%&&%%%%%%%%%%&&&&&&@&%(((/,,,,,,(/
(//#(/***/%/,,...*%&&&&%&&&&&%%%&&&&&&&&&&@@@@@&&&&&&&&&&@@&&&&&&&&&%%&&&&&&&&&&&&&&%(///*,,,,*(/
(//#%&%(/#&%(/////((%&&&&&&%&&&&&&&&&%%#((##%&@@@&&&&&%%%&&&&&@@&&&&%%%&&&&&&&&%%%&&&&&%%(///*,,*(/
((/%@/(%%%#(#%####&&&&&&&%%%%%%%&&&%#(((#(##%%&&&&&%###%&&&&&&&&%%#####%&&@&%((%&&&@/////*,,,(/
((/%@#%%#(((####%%%&%%&&&%%(((//#%%&&%#(((%%%%%&&&,,*#&%%%%#%%##%##(##%%#(//((#%&&%((((/**,,,(/
(//%((##(#%#######&&&%%&&%#///**/(###(((##((##%%&@,,*(%&&&%%##(((#(((((//////(#%&&&%(*****,,*(/
((/%&%####(%&%%%#((/#%&&&&&%#/***,,,,***//***/(##&&&%(,,*(%&&&%%#((/******///***/(#%&@@%(*****,,*(/
(//%&&%##(#&@@&%%%#///(%&&&&%/**,,,........,*/#&&&&&%(,,*/#@@&&&%##(/*****,,,..,/(%&&%#(/****,,,*(/
(//#((((/*(&@@&%%%&%(/(%%&&&/**,,......,**(#&&&&&%#(,,,/(&&&&&&%##(/****,,...*(%&&%#((/***,,,,*(/
(//(/****,*#&@@&&%(#&%#####%&&%#((//****/(#%%#(%&&&%#(,,*/#&&%#(#%%%##((((////(%%&&&((#((/*,,,,,*(/
(//(/*****#%&@@@&%#(#%%##((#%&&%###((/(##%%#,..*#&&&&%(/(#%&%(/****/(%%%##((((#%&&&%/((((*,,,,,,*(/
(//(///(##%&&@@@&%%((#%&&(/(%&&%%#####%#(/,.   ..*(#%%%%%%%/***,...,,*(#%%%%###%%%%#*/((/,,,,,,,*(/
(//#%&&&&&&@@@&%#((#%&&&@(**/(/****,,..         ........,,,,.......... ..*(####%%%%(..,,,,,,,,,,*(/
(//%&&@@@&&&@&%(/(#%@&&&@(**(%###%/,.        ......,,,,,***,,,,....     ..(%%%%%%%#/.,***,,,,,,,*(/
(//%@&%%%&@&%#####%@&&&@&/,.*(/*,.         .,*/(#%&&&%%&&&&&&&&%(/*,.     .,/#%%#(/,.,/(#(/*,,,,*(/
(//%%%%&&@%##%#%&@&&@@%,...,,.         ...,*/((//((##%%%#(/(//*,,,.       .*(%#/*. .*/(###/*,,,(/
(//%&&&&%#%&@@#%&&%#(*.    ......    .....  .,/#####(((##%##(* ....         .**,,...,*,***/#(*,(/
(//%@&&%##@@@&%####/,.       ....      .....  ...,*(##%%%%%#(*,. .....     .   ,*,....*//*,,,*(/*(/
((/%@@&%%%@@@&%(*,,..                  .....     ....,,,,,,,....    ..      .  .,,,. .,*//*,,,***(/
(//%@&%%&&%#/*,....                    ....      .....   ..          .    .       .,..,*//***,,,,(/
((/%&%###(*,,,..                       ..       .............        ..   ..       .. .,*//*,,,,,(/
///%(*****..                               .......................  .....              ..*///*,,*(/
///#/**,.                                  ..............................             ..,**///,,*(/
///#*.                                     ..........................  ...             .*((///*,*(/
///(.     ....      ..,,,....             .......................      ...              ./****///(/
/**(,. .....      .,//*,....              .......................      ...              .,,**///##/
,,*(*,,,..     ,/(((,,,,,                .......................       ...              ./%(****,
.,*(*,..     .,(((/,,**,.                .................... ...      ....             ./%#*/##(((
.,*(,.    .,//****,***..                .................      ..      ....   .     ..,,,(%#///**/*
 .*(.   .,//(/,.,*,,.    .              ............           .....    ....  . ..*%&%%%&&%/,.  .//
..*/...,*////,.*/*,.    ..             .............           ......   ....  ...,(%**////*. ,,,*(/
*,*(**////*,,,/#(,....,,,        .......,,......................,,,..............,/(*((/*.. .((//#(
##/////******///*,,,,,***,,,,,,,,,,,,,,,**,,,,,,,,,,,,,,,,,,,,,***,,,.,,,,,,,,,*/(#(*//**,***///##()") {}

const Card *HuaTuo::castCard(const Card *card) {
    if (card == nullptr || card->getSuit() != HEARTS || card->getSuit() != DIAMONDS) {
        throw NonCastableCardException(card);
    }
    const Card *castedCard = new Peach(card->getSpot(), card->getSuit());
    castedCards.push_back(castedCard);
    return castedCard;
}

LuBu::LuBu() : Hero(NEUTRAL, MALE, 4, "吕布", R"(,/(#(*#%%(/####((((((((((((((((((((((((((((((((((((((((((((((((/(((((((((((((/*,......,*/(####/
  .,/(#&%/%&%#/%#////////////////////////////////////////////////////////////////////*********//(#(
*//#&%#%%/%@&%(#/*%@@@@@@@@@@@@@@@@@@@@@@@@&%&@@@@&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%(((
#%#(##%#/,,**/(#//%@@@@@@@@@@@@@@@@@@@@@@@@&&&&@@&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&@@@@@@@@&&&@%(((
#&&&&%(,.   .,//*/#&@@@@@@@@&%&@@@@@@@@@@@@@@@&&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&@@@%(((
#####/.  ,@@@@@@@@&&@@@@@@@&%%#%&@@@@@@@@@@@@@&%%#%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%(((
####%(,..,@@@@@@&%(#@@@@@@@&%%#(#&@@@@@@&&%%%###%%%%&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&@%(((
/#######//@@@@@@&&&&**#&@@&&%%#(/(@@@@&&%%%#///#&%%%&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&@@%(((
((/***//*(@@@@@@@@@&/*/#&@&&(//(&@@&&%%#((*/#&&&&@@@@@@@@@@@@@&&&@@@@@@@@@@@@@@@@@@@@@&&&@@@@%/((
(//%&&@@@@@@@@@@@&&/*/#@@&&%%#(#@@&%%##(/*/#&&&&@@@@@@@@@@@@&%%&@@@@@@@@@@@@@@@@@@@@&%%@@@@@@%/(/
(//#%%&&@@&&&&&&&&&&%#(//#&@&%%&@@@&%##%&%%%&&&&&%#%&@@@@&###%&%%%%%&@@@@@@@@@@@@&%%&@@@@@@@@%/(/
(//#%%%&&@&&&&&&&&&&&%##(/#&&%#%%&&%#%&@@@@@@@@@(#&&&&%######%&&&%%&&&@@@@@@@@&&%%&@@@@@@@@@@%///
(//%%%#%&@@&&&@&&&@@@&&&%/(&&(/#%&&%#%&@@@@@@@&&%#((((#%%#######%%&%%####%&&&&%%%%%&@@@@@@@@@@@%///
(//%%##%%&@&&%&&%%%&&&%%(%&%%&&&##&@@&&&%%####%%&@@&&&&&&%%#((%&&((#%((#%@@@@@@@@@@@@@@@@%/(/
((/%%%#%%%@@&&%&&%%######%((%&&&&&%#((%&@@&###%&&&&%%%%%&&&&&%(#%%%&&&&#%&@@@@@@@&&@@@@@@@@%/((
(//%%%%%%%&&&&&&&&@&%###%&%(/%&@&((/*%&&%###((((##%&&&&%%#%%%#&&&&&&&&&&%&@@@@@@@@#%&%%&@@@@@%/(/
(//%%%%%#%&&&&&&&@@@@&%%%&%#((%&&%((//(&%##%&&&&&&&&&%#((((%&&&&&&&&&&@@@&&@@@@@@@@&%&&%#%&@@@@%/(/
(//%&%%##%&&&&&&&&&@@@@@&&&%#(#%%#((#%&&&&&&&&&%%##(//(#(((%&@@@%%%%%&&@@&&@@@@@@@@@@@@@@@@@@@@%/(/
(//%&%%%##%&&@@@@@@&&&&&&@@@%%%##&&@@&&%##%%(*,*/(%&&%%%&(/*/((##&@@&%@@@@@@@@@@@@@@@@&@@@@%/(/
(//%&&%%%#%&@@@@@@@@@&&%%&@@@&&%##&@@@&%#((%%(//(%%&@@@@&%#/**/(##(/(&&%%&@@@@@@@@@@&&%#%%%&@@@%/(/
(//%@&&&%%#%&@@@@@@@&&@@#%@@&%%&@&&%%(%&@@&&&@@@@@&&&&&%%%%%%%(//(&&&@@@@@@@@@@@@@@@@@@@@@@@@%/(/
(//%@@@&&%#%&@@@@@@@@@@@@%#%&&&&&@@&&&%&@@@@@@@@@@@@@@@&&&&&&%%#*,*(#%%&&&&@@@@@@@@&&&&&&&@@@@/(/
(//%&&@@&%#%%@@@@@@@@@@@@@@&&&&&&@@@@@@@@@@@@@@@@@@@@@&%#(#&%%#/,,,*/##%%&@&@@@@@@@&@@&&&@@@&&/(/
(//%&&&@@&%#%&@@@@@@@@@@&&@@@@@%%%&&&@@@@@@@@&/*/(%%%##%&&%/*,,**/(%%&&&&@@@@@@&&&@@@@@@@@@@/(/
(//%&&&@@&%%#%&@@@@@@@@@@%%&@@@&%#&&&&@@@@@@@@@&&%%&&&&&&%%(*,,,,*/(#%&&&&&@@@@@@@@@@&&@@@@@@(*(/
(//%&%&@@@%%##%&@@@@@@@&&@@@@@@@%(#%%&&@@&&&&&&&&&&%#((((/*,****//(#%&&&&&&&@@@@@@@@@@@@@@@@&%#(*((
(//%&%&&@@&%%##&&@@@@@@&&%%&&@@/((#%%&&&&&%###((((///********/(((#%&&&&&&@@@@@@@@@@@@@@@@&%%#(*(/
(//#&&%&@@&&%%#%&&@@@@@&&%#%&@@//((#%%%%%%%%####((((//******//(##%&&&&&&&@@@@@@@@@@@@@@@@&%%#(*(/
(//#%%%%&@@&&%%#%&&@@@@@@&&@@@@**//(((((///////////******//((##%%%&&&%%%&&@@@@@@@@@@@@@@&%%#%(/(/
(//%%%%%%&@@&&%#%%&&@@@@@@@@@@@***///((//**********,,,***///(#%%%&&&%%%%%&@@@@@@@@@@@@@&%%#%%#/(/
(//%&%%%%%@@@@&%%%%&@@@@@@@@@@@&(**/(((((((/**********,,*****//(%%%%&%%%%%&@@@@@@@@@@@@@@%%%%&/((
(//%&&%%%%&@@@@&%%%&@@@@@@@@@@@&(**/(##(/((#/,,,,,,,,*********//#%%%%%%%%%&@@@@@@@@@@@@@&%%%&&/(/
(//%@@@&&&&&&@@@%##%&@@@@@@@@@@&(*.*///,,*/#(*,,,,,,,,,,**//////(#%%%%%%&&@@@@@@@@@@@&&&&&&&&&/(/
((/%&@@@@&&&&&@@&%#%&&@@@@@@@@@*.,,,,((#%&*,,,,,,,,,..,,*////((##%%%%%&&@@@@@@@@@@&&&%&&&&&&/(/
(//%&&&@@@@&&&&@@&%%%&@@@@@@@@@@&(.,,*(&@@@%/**,,****,,,,,,*/(((((#%%%%&@@@@@@@@@@&&&%&&&&&&&&%(*(/
((/%&&&&&&@@&&&&&@&%%&&@@@@@@@@@@@@@@@@@@@@&((//*,,*((/*,,***/((((#%%&&@@@@@@@@&&&&&&&&&&&&%%#%(*(/
(//%&&&&&&@@@&&&&&&&%%&&@@@@@@@&&@@@@@@@@&&&&%%%%%#%&@&%#/*///(((##%%@@@@@@@@@&&&&&&&&&&&%%###%(/(/
///%@&&&&&&&&&@&&%&&&&&&@@@@@@@@@&&&@@@&&%%#((((((((/**(#(/*///(##%%&@@@@@&&&&&%%%&&&&&%%#####%#/(/
//(&@&&&&&&&&&&@&&&&&&&&&@@@@@@@@&&&@@@@@@@@&&&&%##((/,,*/*///((#%&@@@@&&&&&&%%%&&&&&%######%%&%/(/
///%@@@@@&&&&&&@@@&&&&&&&@@@@@@@@@&&&@@@@@@@@@&&%##(/*,,***//((#%&@@@@&@@&%%%%%&&&&%######%%&&@%((/
///%&@@@@@@&&&&&&&@@&&&&&&@@@@@@@@@&&&&@@@@#((////*,,****(##%%@@@&&&&&%%%%&&&&%%####%%&@@@@&%(((/
///%@&@@@@@@&&&&&&&@@@&&&@@@@@@@@@@@&&&@@@@&(/*,,,,,,,,,**/#%&&@@@&&&&&%%%&&&&&%###%%&&&@//((//(##/
,*/%&&@@@@@@@@&&&&&&@@@@&&&@@@@@@@@@@@@@@@@@&%%########%%%%@@@@@&&@&&%&&&&&&%%#%&&&&&&@&&(%(****,
.,/%&&@@@@@@@@@&&&&&&@@@@&&&&@@@@@@@@@@@@@@@@@@@&&&&&&&&@@@@@@@&&&&&%&&&&&%##%&&&&&&&&%%%(%#/(%%%%%
.,/%&&&@@@@@@@@&&&&&&&@@@@&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&@&%%%&&&%%##%&&&&%%%##((###%#/(#####
 ./%&&&&@@&&&&&@@&&&&&&&&&@&&&%&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&%%&&&&%##%&@@@@@,*%&%%%&&%/,.  .//
../%&&&&&&&&&&&@&&&&&&&&&&&&&&&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@&%%&&&&&%&&&@@@@@&&%(*(%*/////*..,*,*(/
*,/%&&&&&&&&&&&@&&&&&&&&&&&&&&@@@&@@&&&@&&&&&&@@@@@@@@@@@@&%%&&&&&&&@@@@@@%%###//(/%@&%,. .((#(
##(((((((((((((((///////////////////////////////////////////////////***///***//(((#(/%@,***/((##()") {}

const Card *LuBu::castCard(const Card *card) {
    class LuBuStrike : public Strike {
    public:
        LuBuStrike(Spot spot, Suit suit) : Strike(spot, suit) {}

        void takeEffect(Player *source, const std::vector<Player *> &targets) const override {
            if (source->getStriked()) {
                throw NonPlayableCardException(this);
            } else {
                Player *target = source->selectTarget();
                if (target == source) {
                    throw SelfTargetException(source);
                } else if (!target->getHealth()) {
                    throw DeadTargetException(source);
                } else {
                    source->printPlay(this, target);
                    cout << "The target must use two Dodges." << endl;
                    try {
                        const Card *card1 = target->requestCard(DODGE);
                        target->printPlay(card1);
                        const Card *card2 = target->requestCard(DODGE);
                        target->printPlay(card2);
                    } catch (DiscardException &e) {
                        target->printHit(this);
                        target->decreaseHealth();
                    }
                    source->setStriked(true);
                }
            }
        }
    };

    if (card == nullptr || card->getAction() != STRIKE) {
        throw NonCastableCardException(card);
    }
    const Card *castedCard = new LuBuStrike(card->getSpot(), card->getSuit());
    castedCards.push_back(castedCard);
    return castedCard;
}

DiaoChan::DiaoChan() : Hero(NEUTRAL, FEMALE, 3, "貂蝉", R"(    ,/(#(*%@@%/###(((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((/*,......,*/(####/
  .,/(#&%/%@@%(%#/*/////////////////////////////////////////////////////////////////***********/(#(
*//#&%#%%/%@@%(#//%@@@@@&&&&&&@@@@&&&&&&&%%%%&&&&&&&&&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@%%&&@@@@@@%(/((
#%#(##%#/,***/(#//%&&@@@@&&&%&&&&&%#//(%%&&%%%%%%&&@@&&%%%&@@@@@@@@@@@@@@@@@@@@@@@(#%%&@@@@@(((
#&&&&%(,.   .,*/*/%@@@@@@&&&&&%%%#*,...*(#%%&&&%%##%&&@@@&&&&&@@@@@@@@@@@@@@@@@@@&(*(((###&@@@@%(((
#####/,  ,@@@@@@@@@@@@@@&&&&&%%%#(,..    ..*(#%%&&&%%%%%&&&@@@@&&@@@@@@@@@@@@@@@@%#/#((##(#&@@@%(((
&%%%%(,..,@@@@@@@@&&&&&&%%##/,,*#%(,.       ,*(##&&&%%%%%%%%&&@@@@@@@@@@@@@@@@@@@&%##(///(%&@@@%(((
/#######//@@&&&%##(/,,..        .,%*.      .,*/#####&&&&&%%%%%&&&&@@@@@@@@@@@@@@@&%%%#(#%&@@@%(((
((/***//*(@&%#(*,..            .,*(#%%(. .. .*//*,,/(((##%%&&&&%%%%&&&&@@@@@@@@@@@@@@@&&&%&&@@@%/((
(//%@@@@@@%(*..               ..*/,*/#&/,,. ,***,   .,//((###%%%&&&&&&&&&@@@@@@@@@@@&&&%#%%%&@@%/((
(//%@@&%#(#*.               ....,,**,,*%*,*/,.       ..,*(####/((#%&&&&&&&@@@@@@@@@&&&&&@@@@@%/(/
(//%@*..(/,.               .,,,,*,,,,/#%%(/*,      .,..  .,*(#%%#((%&&&&&&&&&@@@@@@&&&&@@@@@@%///
(//%@&(,  */*.           .   ...,**,,***//#%(,    .,,,.    ..,*/#%&@@@&&&&%%%%%&&&@@@@@@&@@@@@@%///
(//%&*.  ,//,          .,,,**,,*,*///(///(##(//(*,.....,*(#%%&&&%(/#%&&&%%%###%%%&@@@@@@@@@@@%/(/
((/%&&%(*...*//            .,,****///***/((/*(%&%,....,*/(#&&&&&&*,###(/**/(####%%@@@@@@@@@@@%/(/
(//%&%&%%#/**/(/**///****/////(////**,,(##/,.,,,*#(/*,/(%%%/#&&##((/*,. .....,,**/%&@@@@@@@@@%/(/
(//%@&%&%#,,***/*,,***,,,,,,,,.,,,**///((/,.  .,,*(####%&&%(%&&%(/**,... ......,,,,*(%&@@@@@@@@%/(/
(//%@&&&&%,.   .,,..               .,***,.     ..***(#%&&%%#(/*,,..............,,,,*/(%&@@@@@@@%/(/
(//#&@@&&/.            ..,*((((*.....        ..,,****(#%%*,..................,,,,,*/#%&@@@@@@%/(/
(//#&&@@&&&%/.       ..,**///***,,,,,,,...       ..,***,,*(%#(*,    ...........,,,,,*/(%&@@@@@@%/(/
(//%%&&@@@&&&%/  ......,,,,,******/////**,,.        ....,,...*/##(/*.    ...........*/(%&@@@@@@%/(/
(//%%%&@@@&%%&&,......,,,,,**//(((##(/////*,              ......*(###/*..  .........,*(#&@@@@@@%/((
(//%%%%&@@@&%%*...,,,,*/((##%%%%%%#(/**/**..                ......,(###(,... .....,*/#&@@@@@@%/(/
(//%&&%%&@@@@&&%%#(***/(#&&&&&&&%(..,,,,*****,.                          .*/((#(((((((#%&@@@@@@%/(/
(//%@&&&&&@@@@@&%((#/(#%#&&&%#%#*,...,,,,,*,,.                              .,,**/(##%&@@@@@@%/(/
(//%@@@&&&@@@@@@@&%(%&&&%%%&&%#(/*.....,,,,,,,,,.                                ...,*/##%&@@@@#/(/
(//%@@@@@@&@@@@@@@@&(#%%%%%%#(/*,...........,,,,,                                 ..,*(##/#&@@@#/(/
(//%@@@@@@&&&@@@@@@@((#(//*,,..............,,,,.                                ..,*(#(,*(&@@#/(/
(//%@@&@@@@@&&@@@@@@@@&%(*,...........  ......,,,,,.       ...                    ..,/##(,.,*#@#/(/
(//%@@@@&&@@@&&@@@@@@@@&&(/*,........     ....,,,**,.    ..**,.                   ..*(#(/,...,%#/(/
((/#%%%&@@&&&&@&&@@@@@@@&%###*,,.....       ..,,,********///*.                   ..,(#((/,,,..***(/
(//(((##%&&&&&&&&&@@@@@@@&%####/*....       ...,,****//////*,                    ..,##(//,,,.,*,*(/
(//(***/((#%&&&&&&&@@@@@@@@&&%#(/**,..        .....,,*****,.   ..,,**,          ..*(#((/*,,,,,..,(/
((/#*,,,*///(#%&&&&&@@@@@@@@@@&&%(,....          ...........,,,,,****.         ..,/(((//*,,,,..,*(/
(//#/*,,,,*////#&&&@@@@@@@@@@@@&&&%(*,.                 ..,**,,,,***,          .,/(#(////,,..,/**(/
((/(*,***,,,,,,,,*/(%&&@@@@@@@@@@&%%&&%(/,.           ,***********,,.         .*(##(((/*,,,*(((**(/
(//(*,,,,,,,,,,,,,,,,*/((#%&&@@@@@&&&%%(((/,          ...,,***,,,,...        .,(##((((/*,*/(#(*,*(/
///#*,,,,,,,,,,..,,,..,,,*/#%%##%########((((*,..            ...,...       ..*(#((((((/*.*/(/*,,*(/
///#*,,,,,,,,,,,,...,********,....,,,,****//##((/*,..                     .,*/(((##((((/,,/(/****(/
///(*,,,,,,,,,,..,,,,,,..........................,,,,,.....            ...*//((###%%%####/((((///(/
///(*,,,,,,,,,,,,,,.............                      ...,,,,,,,,,,,*(#%%&&&&&&%%%%%&&&&&&&&&&&%((/
///(*,,,,,,,,,*,............                              ..........,***/(((/**,,..,**//(**/((((##/
,,/(/*,,,,,**,.........                                                 .,,,...     ...../%(****,
.,*(/***,,*,........                                                   .,,.....   ......./%#*/###%%
.,*(/**,**,.......                                                    .,,.......   .,,,.,(%#//***/(
 .*(/****,......                                                     .......     .*%&%%%&&%/,.  .//
..*(*****......                                                      ..  ...    .,(%**/*//*. ,,,*(/
*,*(***,......                                                  ................,,/(*(/*,.. .//*/#(
##//**********,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,*/(#(*(/,.,***///##()") {}

const Card *DiaoChan::castCard(const Card *card) {
    class DiaoChanDuel : public Duel {
    public:
        DiaoChanDuel(Spot spot, Suit suit) : Duel(spot, suit) {}

        void takeEffect(Player *source, const std::vector<Player *> &targets) const override {
            cout << "Two targets need to be selected. "
                    "The first one is the source of Duel. "
                    "The second one is the target of Duel." << endl;
            Player *target1 = source->selectTarget();
            Player *target2 = source->selectTarget();
            if (target1 == source || target2 == source) {
                throw SelfTargetException(source);
            } else if (target1 == target2) {
                throw SelfTargetException(target1);
            } else if (!target1->getHealth()) {
                throw DeadTargetException(target1);
            } else if (!target2->getHealth()) {
                throw DeadTargetException(target2);
            } else if (target1->getHero()->getGender() == FEMALE) {
                throw GenderException(target1);
            } else if (target2->getHero()->getGender() == FEMALE) {
                throw GenderException(target2);
            } else {
                target1->printPlay(this, target2);
                while (true) {
                    try {
                        target2->printPlay(target2->requestCard(STRIKE));
                    } catch (DiscardException &e) {
                        target2->decreaseHealth();
                        break;
                    }
                    try {
                        target1->printPlay(target1->requestCard(STRIKE));
                    } catch (DiscardException &e) {
                        target1->decreaseHealth();
                        break;
                    }
                }
            }
        }
    };

    if (card == nullptr) {
        throw NonCastableCardException(card);
    }
    const Card *castedCard = new DiaoChanDuel(card->getSpot(), card->getSuit());
    castedCards.push_back(castedCard);
    return castedCard;
}

Hero *newHero() {
    switch (rand() % 5) {
        case 0:
            return new ZhaoYun();
        case 1:
            return new ZhenJi();
        case 2:
            return new HuaTuo();
        case 3:
            return new LuBu();
        case 4:
            return new DiaoChan();
        default:
            return nullptr;
    }
}
